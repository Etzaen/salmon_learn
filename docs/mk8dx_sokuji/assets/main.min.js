"use strict";var mouseChaser,inputRankData,scanedNameData,SCORES=[15,12,10,9,8,7,6,5,4,3,2,1],version="0.2.0",isTouchDevice="ontouchstart"in document,mousedownEvent=isTouchDevice?"touchstart":"mousedown",mouseChaserStyle=isTouchDevice?"none":"block",browser=(()=>{const e=window.navigator.userAgent.toLowerCase();return e.indexOf("msie")>-1||e.indexOf("trident")>-1?"ie":e.indexOf("edge")>-1?"edge":e.indexOf("chrome")>-1?"chrome":e.indexOf("safari")>-1?"safari":e.indexOf("firefox")>-1?"firefox":e.indexOf("opera")>-1?"opera":"other"})(),os=(()=>{const e=window.navigator.userAgent.toLowerCase();return e.indexOf("iphone")>-1?"iphone":e.indexOf("ipad")>-1?"ipad":e.indexOf("android")>-1?(e.indexOf("mobile"),"android"):e.indexOf("windows")>-1?"windows":e.indexOf("mac os x")>-1?"mac":"other"})(),isPC="windows"===os||"mac"===os,playerNum=12,teamTableIndex=10,scKeyIndex=20,rankTableIndex=30,teamMaxNum=6,currentPen=-1,penDown=!1,rightDown=!1,isCalculating=!1,isInitialized=!1,tallyForScoresTimer=0,tallyForScoresDelay=20,sampleTeamData=null,storageKey="mk8dx-sokuji",saveTargetVariables=["teamNum","raceNum","teamNames","shortCutKeys","tallyConfig","inputRankData"],isEnabledSS=isPC,teamNum=2,raceNum=12,maxRaceNum=12,maxPlayerNum=12,teamNames=["AAA","BBB","CCC","DDD","EEE","FFF"],shortCutKeys=["a","b","c","d","e","f"],tallyConfig={onBeforeUnload:!1,isEnabledComplement:!0,latestScore:!0,latestScoreDif:!0,latestCource:!0,totalScore:!0,totalScoreDif:!0,leftRaceNum:!0,currentRank:!0,targetDistance:!0,winDetermine:!0,emphasisStr:"【】",emphasisStart:"",emphasisEnd:"",splitStr:"／",teamSplitStr:"／",passRank:2};function initConfigElements(){[{key:"isEnabledComplement",id:"cfg-auto-complement"},{key:"latestScore",id:"cfg-latest-score"},{key:"latestScoreDif",id:"cfg-latest-score-dif"},{key:"totalScore",id:"cfg-total-score"},{key:"totalScoreDif",id:"cfg-total-score-dif"},{key:"latestCource",id:"cfg-latest-course"},{key:"leftRaceNum",id:"cfg-left-race-num"},{key:"currentRank",id:"cfg-current-rank"},{key:"targetDistance",id:"cfg-target-distance"},{key:"winDetermine",id:"cfg-win-determine"},{key:"onBeforeUnload",id:"cfg-on-before-unload"}].map(e=>{var t=document.getElementById(e.id);!0===tallyConfig[e.key]&&(t.setAttribute("checked","checked"),"onBeforeUnload"===e.key&&(window.onbeforeunload=function(){return"本当に他のページに移動しますか?"})),t.addEventListener("change",function(t){tallyConfig[e.key]=this.checked,saveStorage(),tallyForScores(),"cfg-on-before-unload"===this.id&&(this.checked?window.onbeforeunload=function(){return"本当に他のページに移動しますか?"}:window.onbeforeunload=null)},!1)}),[{key:"passRank",className:"cfg-pass-rank"},{key:"teamSplitStr",className:"cfg-team-split"},{key:"splitStr",className:"cfg-split"},{key:"emphasisStr",className:"cfg-emphasis"}].map(e=>{for(var t=document.querySelectorAll("[name="+e.className+"]"),a=0;a<t.length;a++){var n=t[a];""+tallyConfig[e.key]===n.getAttribute("value")&&n.setAttribute("checked","checked"),n.addEventListener("change",function(t){tallyConfig[e.key]=this.value,tallyConfig.passRank=parseInt(tallyConfig.passRank),saveStorage(),tallyForScores()})}}),updatePassRank(),document.getElementById("copy-button").addEventListener(mousedownEvent,function(e){execCopyResult()})}function initInputDataVariable(){inputRankData=[],scanedNameData=[];for(var e=0;e<maxRaceNum;e++){inputRankData[e]=[],scanedNameData[e]=[];for(var t=0;t<maxPlayerNum;t++)inputRankData[e][t]="-1",scanedNameData[e][t]=null}}function setEventShowMore(e){var t=document.querySelector(e),a=t.getAttribute("show"),n=document.querySelector("#"+a);t.addEventListener(mousedownEvent,function(e){"none"!==n.style.display?(n.style.display="none",this.textContent=this.getAttribute("text1")):(n.style.display="block",this.textContent=this.getAttribute("text2"))}),t.textContent=t.getAttribute("text1")}function makeRadioButtons(){return e(".race-num-radio","raceNum"),void e(".race-type-radio","teamNum");function e(e,a){for(var n=document.querySelectorAll(e),r=0;r<n.length;r++){t(n[r],a)}}function t(e,t){e.addEventListener("change",function(e){var a=parseInt(this.value);window[t]!==a&&(window[t]=a,updateInputTeamNameTable())}),window[t]===parseInt(e.value)&&e.setAttribute("checked","checked")}}function updateInputTeamNameTable(){makeInputTeamNameTable(),makeInputRankPalette(),makeInputRankTable(),updatePassRank()}function updatePassRank(){for(var e=document.querySelectorAll(".cfg-pass-rank"),t=0;t<e.length;t++){var a=e[t];parseInt(a.getAttribute("rank"))>=teamNum?a.style.display="none":a.style.display="inline"}}function makeInputTeamNameTable(){var e=document.querySelector("#table-team-name");e.innerHTML="";for(var t=teamNum,a=document.createElement("tr"),n=0;n<t;n++){var r=document.createElement("td");(i=createInput({placeholder:o=["A","B","C","D","E","F"][n],value:teamNames[n]})).setAttribute("tabIndex",teamTableIndex+n),i.setAttribute("id","input-team-name-"+n),i.addEventListener("input",makeInputRankPalette,!1),r.appendChild(i),a.appendChild(r)}e.appendChild(a);var s=document.querySelector("#table-sc-key");for(s.innerHTML="",a=document.createElement("tr"),n=0;n<t;n++){var o,i;r=document.createElement("td");(i=createInput({placeholder:o=shortCutKeys[n],value:o,maxlength:"1"})).setAttribute("tabIndex",scKeyIndex+n),i.setAttribute("id","input-sc-key"+n),i.addEventListener("input",updateSCKey,!1),r.appendChild(i),a.appendChild(r)}s.appendChild(a)}function updateSCKey(){for(var e=0;e<teamNum;e++){var t=document.getElementById("input-sc-key"+e).value;shortCutKeys[e]=t}saveStorage()}function makeInputRankPalette(){return function(){for(var e=0;e<teamNum;e++){var t=document.getElementById("input-team-name-"+e),a=t.value;teamNames[e]=a}}(),function(){for(var e=1;e<=raceNum;e++)for(var t=1;t<=playerNum;t++){var a=document.body.querySelector(".rank-"+t+".race-"+e);if(a){var n=parseInt(a.getAttribute("team"));-1!==n&&(a.value=teamNames[n])}}}(),function(){var t=document.getElementById("input-rank-palette");t.innerHTML="";for(var a=-1;a<teamNum+1;a++){var n,r=document.createElement("div");n=a<0?"キー入力":a===teamNum?"消す":teamNames[a],r.innerHTML="<p>"+n+"</p>",r.setAttribute("id","palette-"+a),r.setAttribute("team-index",a),a===teamNum?r.classList.add("team-"+teamMaxNum):r.classList.add("team-"+a),e(r,a),t.appendChild(r)}isInitialized||t.querySelector("#palette--1").classList.add("selected")}(),void saveStorage();function e(e,t){e.addEventListener("contextmenu",function(e){e.preventDefault()},!1),e.addEventListener(mousedownEvent,function(e){selectPalette(t)},!1)}}function selectPalette(e){var t,a=document.getElementById("input-rank-palette").getElementsByTagName("div");for(t=0;t<a.length;t++)a[t].classList.remove("selected");var n=document.getElementById("palette-"+e);n.classList.add("selected");var r=parseInt(n.getAttribute("team-index"));if(currentPen=r,r>-1){for(t=0;t<teamMaxNum+1;t++)mouseChaser.classList.remove("team-"+t);mouseChaser.classList.remove("hidden"),r===teamNum?(mouseChaser.textContent="　",mouseChaser.classList.add("team-"+teamMaxNum)):(mouseChaser.textContent=teamNames[r],mouseChaser.classList.add("team-"+r)),document.getElementById("input-rank-table").classList.add("pen-mode")}else mouseChaser.classList.add("hidden"),document.getElementById("input-rank-table").classList.remove("pen-mode")}function makeMouseChaser(){var e=document.getElementById("input-rank-area");(mouseChaser=document.getElementById("mouse-chaser")).classList.add("mouse-chase"),mouseChaser.classList.add("hidden"),mouseChaser.textContent="NX",e.addEventListener("mousemove",function(e){var t=e.clientX,a=e.clientY,n="translate("+(t-=mouseChaser.clientWidth/2)+"px, "+(a-=mouseChaser.clientHeight/2+5)+"px)";return mouseChaser.style.transform=n,penDown&&currentPen>-1&&getSelection().removeAllRanges(),!0},!1),e.addEventListener("mouseenter",function(e){mouseChaser.style.display=mouseChaserStyle,penDown=!1,rightDown=!1}),e.addEventListener("mouseleave",function(e){mouseChaser.style.display="none",penDown=!1,rightDown=!1})}function makeInputRankTable(){var e=document.getElementById("input-rank-table");e.innerHTML="";for(var t=raceNum+1,a=playerNum+2+(isEnabledSS?5:3),n=0;n<a;n++){var r=document.createElement("tr");n===playerNum+2&&r.classList.add("rank-end-tr");for(var s=0;s<t;s++)if(0===n&&s>1||0===s&&1===n);else{var o,i=document.createElement("td"),l="",u=1+s-1,c=1+n-2,m=(u-1)*(playerNum+1)+(c-1);s>=1&&n>=2&&n<playerNum+2?S(i,c,u,m):0===s&&0===n?(i.setAttribute("rowspan",2),l="順位"):1===s&&0===n?(i.setAttribute("colspan",12),l="レース番号"):1===n&&s>=1?l=s:0===s&&n>=2&&n<playerNum+2?l=n-1:0===s&&n===playerNum+2+1?l="　":s>0&&n===playerNum+2+1?(l="",y(i,c,u,m)):0===s&&n===playerNum+2+2||(s>0&&n===playerNum+2+2?f(i,c,u,m):0===s&&n===playerNum+2+0?l="コース":s>0&&n===playerNum+2+0?k(i,c,u,m):0===s&&n===playerNum+2+3?l="スクショ":s>0&&n===playerNum+2+3?v(i,c,u,m):0===s&&n===playerNum+2+4?(l="　",i.classList.add("scanable-state")):s>0&&n===playerNum+2+4&&h(i,c,u,m)),l&&(i.textContent=l,i.classList.add("label")),n>=1&&(i.classList.add("race-"+u),i.setAttribute("race",u)),r.appendChild(i)}e.appendChild(r)}$("input.course-cell").MySuggest({msArrayList:MK8DX_COURSES});var d=document.querySelector(".rank-end-tr"),p=document.createElement("hr");r=document.createElement("tr");(i=document.createElement("td")).setAttribute("colspan",t),i.appendChild(p),r.appendChild(i),d.parentNode.insertBefore(r,d);for(var g=1;g<=raceNum;g++)updateRace(g);return void tallyForScores();function f(e,t,a,n){b(e),e.classList.add("state-cell"),e.setAttribute("state-type","lack");var r=document.createElement("img");r.setAttribute("src-complete","assets/state-complete.png"),r.setAttribute("src-error","assets/state-error.png"),r.setAttribute("src-lack","assets/transparent.png"),r.setAttribute("src",r.getAttribute("src-lack")),e.appendChild(r)}function y(e,t,a,n){b(e);var r=document.createElement("img"),s="assets/lock-1.png";r.src=s,e.appendChild(r),e.classList.add("lock-cell"),e.addEventListener("click",function(e){for(var t=this.getAttribute("race"),a=document.querySelectorAll(".race-"+t),n=0;n<a.length;n++)a[n].classList.contains("locked")?(this.querySelector("img").src=s,a[n].classList.remove("locked")):(this.querySelector("img").src="assets/lock-2.png",a[n].classList.add("locked"))},!0)}function v(e,t,a,n){b(e),(o=document.createElement("div")).setAttribute("race",1+s-1),o.classList.add("paste-input"),o.classList.add("race-"+a),o.setAttribute("placeholder","paste"),setEventPasteImage(o,function(e,t){logger.log("🏞️image pasted");var a=parseInt(t.getAttribute("race")),n=".pasted-image-cell.race-"+a+" img",r=document.querySelector(n);isCalculating?notifyFooter("計算中のプロセスがあります。"):(isCalculating=!0,document.getElementById("mask-notice").style.setProperty("display","block"),setTimeout(()=>{trimGameScreen(e,e=>{scanGameScreen(e,t=>{isCalculating=!1,document.getElementById("mask-notice").style.setProperty("display","none"),scanedNameData[a-1]=t,r.style.setProperty("display","block"),r.src=e.toDataURL();var n=document.querySelector(`.pasted-image-cell.race-${a}`);n.classList.contains("specimen")&&(sampleTeamData=null,n.classList.remove("specimen")),existsSampleTeamData()&&scanTeamData(a)})},()=>{alert("ゲーム画面の抽出に失敗しました。"),isCalculating=!1,document.getElementById("mask-notice").style.setProperty("display","none")})},50))}),e.appendChild(o)}function h(e,t,a,n){b(e),e.classList.add("pasted-image-cell");var r=document.createElement("img");setEventZoomImage(r,a),e.appendChild(r)}function k(e,t,a,n){b(e),(o=createInput({className:"race-"+a+" course-cell",id:"rank-input-"+n,race:a,placeholder:"コース",tabIndex:rankTableIndex+n,"rank-input-id":n})).addEventListener("input",function(e){var t=this.selectionEnd;logger.log("inputed course [race "+a+"]["+this.value+"]","gray"),tallyForScores(()=>{this.focus(),this.setSelectionRange(t,t)})},!1),o.addEventListener("change",function(e){setTimeout(()=>{logger.log("inputed course [race "+a+"]["+this.value+"]","gray")},1),tallyForScores()},!1),e.appendChild(o)}function S(e,t,a,n){!function(e){e.addEventListener("mouseenter",()=>{mouseChaser.style.display=mouseChaserStyle})}(e),o=createRankInput(t,a,n),"-1"!==inputRankData[a-1][t-1]&&(o.value=teamNames[inputRankData[a-1][t-1]],resetRankInputClass(o)),e.appendChild(o);var r=function(e){switch(e.type.toLowerCase()){case"mousedown":penDown=!0;break;case"mousemove":if(!penDown)return}if(!isTouchDevice&&(rightDown||2===e.button)){rightDown=!0;var t=this.querySelector("input"),a=parseInt(t.getAttribute("team"));return a<0&&(a=teamNum),selectPalette(a),!1}if(currentPen>-1){var n=(t=this.querySelector("input")).classList.contains("locked"),r=parseInt(this.getAttribute("race"));if(!n){var s;s=currentPen>=teamNum?"":teamNames[currentPen],t.value=s;var o=""===s,[i,l]=(resetRankInputClass(t),updateRace(r,!o));l?tallyForScores(()=>{t.blur()}):setTimeout(()=>{t.blur()},1)}}};e.oncontextmenu=function(e){return!1},e.addEventListener(mousedownEvent,r,!1),e.addEventListener("mousemove",r,!1),e.addEventListener("mouseup",function(e){penDown=!1,rightDown=!1},!1),e.addEventListener("wheel",function(e){if(currentPen<0)return!0;e.preventDefault(),e.deltaY<0?currentPen>=1&&selectPalette(--currentPen):currentPen<teamNum&&selectPalette(++currentPen)})}function b(e){e.addEventListener("mouseenter",()=>{mouseChaser.style.display="none"})}}function createInput(e){var t=document.createElement("input");return t.setAttribute("type","text"),t.setAttribute("spellcheck","false"),e&&Object.keys(e).map(a=>{"className"===a?e[a].split(" ").map(e=>{t.classList.add(e)}):t.setAttribute(a,e[a])}),t}function createRankInput(e,t,a){var n=document.createElement("input");return function(n){n.setAttribute("type","text"),n.setAttribute("spellcheck","false"),n.setAttribute("team","-1"),n.setAttribute("tabIndex",rankTableIndex+a),n.setAttribute("rank-input-id",a),n.setAttribute("id","rank-input-"+a),n.setAttribute("placeholder",e),n.setAttribute("race",t),n.setAttribute("rank",e),n.classList.add("race-"+t),n.classList.add("rank-"+e)}(n),function(e){e.addEventListener(mousedownEvent,function(e){this.classList.contains("locked")&&this.blur()},!1),e.addEventListener("input",function(e){logger.log("inputed ["+e.data+"]","gray");var a=this.selectionEnd,n=null===e.data,r=function(e,t){var a=shortCutKeys.indexOf(t);if(a>-1&&a<teamNum)return e.value=teamNames[a],!0;return!1}(this,e.data);if(r)logger.log("parsed input ["+e.data+"] -> ["+this.value+"]","gray");else{var s=teamNames.indexOf(this.value);if(s<0){var o=this.value;(r=function(e){for(var t=e.value.toLowerCase(),a=0;a<teamNames.length;a++){var n=teamNames[a];if(t===n.toLowerCase())return e.value=n,!0}return!1}(this))&&logger.log("parsed name ["+o+"] -> ["+this.value+"]","gray")}}var i=resetRankInputClass(this),[l,u]=updateRace(t,!n);u?tallyForScores(()=>{this.blur()}):l?this.blur():i?focusDownRankInput(this):(this.focus(),this.setSelectionRange(a,a))}),e.addEventListener("keydown",function(e){switch(e.keyCode){case 13:focusNextRankInput(this);break;case 40:focusDownRankInput(this);break;case 38:focusUpRankInput(this)}},!1)}(n),n}function resetRankInputClass(e){for(var t=0;t<teamNum+1;t++)e.classList.remove("team-"+t);e.setAttribute("team","-1");var a=parseInt(e.getAttribute("race")),n=parseInt(e.getAttribute("rank")),r=e.value,s=teamNames.indexOf(r),o=0<=s&&s<teamNum;o&&(e.classList.add("team-"+s),e.setAttribute("team",s),inputRankData[a-1][n-1]=s);var i=rankStrs[n-1];return logger.log("inputed team [race "+a+"]["+i+"]["+e.value+"]","gray"),setSaveStorage(),o}function focusNextRankInput(e){var t=parseInt(e.getAttribute("rank-input-id")),a=document.getElementById("rank-input-"+(t+1));a&&a.focus()}function focusUpRankInput(e){var t,a=parseInt(e.getAttribute("rank-input-id"));a%(playerNum+1)>0&&(t=document.getElementById("rank-input-"+(a-1))),t&&t.focus()}function focusDownRankInput(e){var t,a=parseInt(e.getAttribute("rank-input-id"));a%(playerNum+1)<playerNum-1&&(t=document.getElementById("rank-input-"+(a+1))),t&&t.focus()}function updateRace(e,t){void 0===t&&(t=!0),t=t&&window.tallyConfig.isEnabledComplement;for(var a=document.body.querySelector(".state-cell.race-"+e),n=a.querySelector("img"),r=a.getAttribute("state-type"),s=0,o=[],i=createArray(teamNum,0),l=1;l<=playerNum;l++){var u=document.body.querySelector(".rank-"+l+".race-"+e),c=u.getAttribute("team");inputRankData[e-1][l-1]=c,"-1"===c?o.push(u):(s++,i[parseInt(c)]++)}var m,d=t;if(t){var p,g=playerNum/teamNum,f=-1;if(s>=g*(teamNum-1)&&s<playerNum){for(var y=0;y<teamNum;y++)if(i[y]===g);else if(i[y]<g){if(-1!==f){d=!1;break}p=teamNames[f=y]}}else d=!1;d&&(logger.log("complemented ranks"),o.map(e=>{e.value=p,resetRankInputClass(e),i[f]++}))}if(d)m="complete";else if(s===playerNum){for(m="complete",y=1;y<teamNum;y++)if(i[0]!==i[y]){m="error";break}}else m="lack";var v=r!==m;v&&logger.log("changed [race "+e+"] state ["+r+"] -> ["+m+"]");var h=document.querySelectorAll(".race-"+e),k=Math.min(h.length-4);for(y=0;y<k;y++)h[y].classList.remove("complete"),h[y].classList.remove("error"),h[y].classList.remove("lack"),h[y].classList.add(m);return a.setAttribute("state-type",m),n.setAttribute("src",n.getAttribute("src-"+m)),a.setAttribute("inputed","complete"===m?"inputed":""),[d,v]}function tallyForScores(e){clearTimeout(tallyForScoresTimer),tallyForScoresTimer=setTimeout(function(){logger.log("tallied scores");var t,a,n=document.body.querySelectorAll(".state-cell"),r=0,s=[];for(t=0;t<n.length;t++)if("inputed"===n[t].getAttribute("inputed")){var o=n[t].getAttribute("race");a=o,s.push(o),r++}var i=raceNum-r,l="",u=document.body.querySelector(".course-cell.race-"+a);u&&(l=u.value);var c=[],m=[],d=[];for(t=0;t<teamNum;t++)c.push(0),m.push(0),d.push({teamIndex:t,teamName:teamNames[t],totalScore:0,latestScore:0});s.map((e,t)=>{for(var a=1;a<=playerNum;a++){var n=document.body.querySelector(".rank-"+a+".race-"+e),r=parseInt(n.getAttribute("team")),o=SCORES[a-1];c[r]+=o,d[r].totalScore+=o,t===s.length-1&&(m[r]+=o,d[r].latestScore+=o)}}),d[0].latestScoreDif=d[0].latestScore-d[1].latestScore,d.sort((e,t)=>e.totalScore>t.totalScore?-1:1),d.map((e,t)=>{e.teamRank=t+1}),d.map((e,t)=>{calcTargetDistance(d,t,tallyConfig.passRank)});var p=createTallyText(d,l,i);document.getElementById("result").textContent=p,isInitialized&&execCopy(p),e&&e(),setSaveStorage()},tallyForScoresDelay)}function getScoreObject(e,t){for(var a=0;a<teamNum;a++)if(e[a].teamIndex===t)return e[a]}function calcTargetDistance(e,t,a){var n,r=getScoreObject(e,t),s=r.teamRank;n=s<=(a=Math.max(1,Math.min(teamNum-1,a)))?a+1:a,r.targetDistance=e[s-1].totalScore-e[n-1].totalScore,r.targetDistanceStr=n+"位との点差:"+parseSignedNum(r.targetDistance)}function createTallyText(e,t,a){var n=tallyConfig,r=[],s=getScoreObject(e,0);if(n.emphasisStr.length>=2?(n.emphasisStart=n.emphasisStr.charAt(0),n.emphasisEnd=n.emphasisStr.charAt(1)):(n.emphasisStart="",n.emphasisEnd=""),2===teamNum){var o="";if(n.latestScore){for(u=0;u<teamNum;u++){u>0&&(o+="-"),o+=(c=getScoreObject(e,u)).latestScore}n.latestScoreDif&&(o+=" ("+parseSignedNum(s.latestScoreDif)+")")}else n.latestScoreDif&&(o+=parseSignedNum(s.latestScoreDif));o&&r.push(o)}var i="";if(2===teamNum){if(n.totalScore)for(i+="合計: ",u=0;u<teamNum;u++){var l=(m=(c=getScoreObject(e,u)).teamName)+" "+(d=c.totalScore);u>0&&(i+="-"),u>0&&(l=d+" "+m),i+=l}}else if(n.totalScore||n.totalScoreDif)for(var u=0;u<teamNum;u++){var c,m=(c=e[u]).teamName;0===c.teamIndex?(m=n.emphasisStart+m+n.emphasisEnd,u>0&&"【"!==n.emphasisStart&&"／"!==n.teamSplitStr&&(m=" "+m),"】"!==n.emphasisEnd&&(m+=" ")):(u>0&&"／"!==n.teamSplitStr&&(m=" "+m),m+=" ");var d=c.totalScore,p=s.totalScore-c.totalScore;p=p>0?"+"+p:0===p?"±0":""+p,n.totalScore?n.totalScoreDif&&s!==c&&(d=d+" ("+p+")"):n.totalScoreDif&&s!==c&&(d=p);l=m+d;u>0&&(i+=n.teamSplitStr),i+=l}if(i&&r.push(i),2===teamNum)n.totalScoreDif&&r.push("点差: "+parseSignedNum(s.targetDistance));else{if(n.currentRank){var g="現在"+s.teamRank+"位";r.push(g)}n.targetDistance&&r.push(s.targetDistanceStr)}var f="";n.latestCource&&(f+=t),n.leftRaceNum&&(f+="＠"+a),f&&r.push(f);var y=0;switch(teamNum){case 2:y=40;break;case 3:y=36;break;case 4:y=31;break;case 6:y=24}var v=a*y;1===s.teamRank&&(e[0].totalScore-e[1].totalScore>v&&n.winDetermine&&r.push("勝利確定!"));return" /"===n.splitStr&&(n.splitStr=" / "),r.join(n.splitStr)}function parseSignedNum(e){return(e>=0?"+":"")+e}function execCopy(e){var t=document.createElement("div"),a=document.createElement("pre");a.style.webkitUserSelect="auto",a.style.userSelect="auto",t.appendChild(a).textContent=e;var n=t.style;n.position="fixed",n.right="200%",document.body.appendChild(t),document.getSelection().selectAllChildren(t);var r=document.execCommand("copy");return document.body.removeChild(t),r&&notifyFooter("コピーしました: "+e),r}function execCopyResult(){var e=document.querySelector("#result"),t=document.createRange();t.selectNode(e),window.getSelection().addRange(t);try{var a=document.execCommand("copy")?"successful":"unsuccessful";logger.log("copy command was "+a),notifyFooter("コピーしました: "+e.textContent)}catch(e){logger.log("unable to copy")}window.getSelection().removeAllRanges()}function trigger(e,t){var a=document.createEvent("Event");a.initEvent(t,!0,!0),e.dispatchEvent(a)}window.addEventListener("load",function(){logger.log("document loaded"),logger.log("initializing mk8dx-sokuji"),initInputDataVariable(),loadStorage(),setEventShowMore("#input-rank-description-show"),setEventShowMore("#input-rank-description-show-2"),makeRadioButtons(),makeInputTeamNameTable(),makeInputRankPalette(),makeInputRankTable(),makeMouseChaser(),makeZoomImage(),initConfigElements(),document.getElementById("reset-button").onclick=(()=>{window.confirm("順位テーブルをリセットします。よろしいですか？")&&(sampleTeamData=null,initInputDataVariable(),updateInputTeamNameTable())}),logger.log("initialized mk8dx-sokuji"),isInitialized=!0},!1),window.logger={log:(e,t)=>{if(t){e="%c"+e;var a="color: "+logger.color[t]+";";console.log(e,a)}else console.log(e)},color:{black:"#000",gray:"#aaa"}};var saveStorageTimer=null;function setSaveStorage(){clearTimeout(saveStorageTimer),saveStorageTimer=setTimeout(function(){saveStorage()},2e3)}function saveStorage(){var e={};saveTargetVariables.map(t=>{e[t]=window[t]});var t=JSON.stringify(e);localStorage.setItem(storageKey,t),logger.log("set storage data")}function loadStorage(){var e=localStorage.getItem(storageKey);if(null!==e){logger.log("storage data exist"),logger.log("merging variables to window");var t=JSON.parse(e);saveTargetVariables.map(e=>{void 0!==t[e]&&("tallyConfig"===e?Object.keys(t[e]).forEach(a=>{window[e][a]=t[e][a]}):window[e]=t[e])})}else logger.log("storage data doesn't exist")}function scanTeamData(e){if(!existsSampleTeamData())return alert("標本の作成が済んでいません。"),!1;logger.log(`scaning race ${e}...`);var t=scanedNameData[e-1],a=getTeamRankArray(t,sampleTeamData);logger.log("scaned!"),logger.log(a);for(var n=1;n<=12;n++){var r=".race-"+e+".rank-"+n,s=document.querySelector(r);s.value=a[n-1],resetRankInputClass(s)}return updateRace(e),tallyForScores(),!0}function makeSampleTeamData(e){if(logger.log(`making specimen with race ${e}...`),"inputed"===document.body.querySelector(`.state-cell.race-${e}`).getAttribute("inputed")){for(var t=scanedNameData[e-1],a=!0,n=0;n<t.length;n++)if(null===t[n]){a=!1;break}if(a){var r=inputRankData[e-1];sampleTeamData=[],t.forEach((e,t)=>{sampleTeamData.push({id:t,name:e,teamName:teamNames[r[t]]})}),logger.log("maked!"),logger.log(sampleTeamData);var s=document.querySelector(".specimen");return s&&s.classList.remove("specimen"),document.querySelector(`.pasted-image-cell.race-${e}`).classList.add("specimen"),!0}return logger.log(`error! race ${e} scan data is missing.`),alert("スキャンデータがありません。"),!1}return logger.log(`error! race ${e} rank is missing.`),alert("順位の入力が済んでいません。"),!1}function existsSampleTeamData(){return null!==sampleTeamData}var rankStrs=["1st","2nd","3rd","4th","5th","6th","7th","8th","9th","10th","11th","12th"],hankakuStrs=["1","2","3","4","5","6","7","8","9","0","-","^","\\","q","w","e","r","t","y","u","i","o","p","[","a","s","d","f","g","h","j","k","l",";",":","]","z","x","c","v","b","n","m",",",".",",",".","/","\\","a","i","u","e","o"],zenkakuStrs=["１","２","３","４","５","６","７","８","９","０","－","＾","￥","ｑ","ｗ","ｅ","ｒ","ｔ","ｙ","ｕ","ｉ","ｏ","ｐ","「","ａ","ｓ","ｄ","ｆ","ｇ","ｈ","ｊ","ｋ","ｌ","；","：","」","ｚ","ｘ","ｃ","ｖ","ｂ","ｎ","ｍ","，","．","、","。","・","￥","あ","い","う","え","お"],MK8DX_COURSES=[["マリカス","marikasu"],["ウォタパ","whotapa","ulotapa","uxotapa"],["ドッスン","dossun"],["遺跡","いせき","iseki"],["マリサ","marisa"],["新マリサ","しんまりさ","sinmarisa","shinmarisa"],["ねじれ","nejire","nejire"],["ヘイ鉱","へいこう","heikou"],["ヘイホー","heiho"],["空港","くうこう","kuukou"],["ドルみ","dorumi"],["岬","みさき","misaki"],["エレドロ","eredoro"],["ワリスノ","warisuno"],["雪山","ゆきやま","yukiyama"],["スカガ","sukaga"],["ホネホネ","honoehone"],["骨々","ほねほね","honehone"],["クパキャ","kupakya"],["新虹","しんにじ","shinniji","sinniji"],["ヨシサ","yoshisa","yosisa"],["エキバ","ekiba"],["ドラロ","doraro"],["ミュート","myu-to"],["ベビパ","bebipa"],["チーズ","ti-zu","chi-zu"],["ネイチャー","neitya-","neicha-"],["どう森","doumori"],["モモカン","momokan"],["スイキャニ","suikyani"],"GBA",["プクビ","pukubi"],["プクプク","pukupuku"],["ハイウェイ","haiwei"],["カラカラ","karakara"],["平野","へいや","heiya"],["ピチサ","pitisa","pichisa"],"DKJ",["ジャングル","janguru","zyanguru"],["ワリスタ","warisuta"],["シャベラン","shaberan","syaberan"],["ミューパ","myu-pa"],["ヨシバ","yoshiba","yosiba"],["チクタク","chikutaku","tikutaku"],["パクスラ","pakusura"],["火山","かざん","kazan"],["グラグラ","guragura"],"64虹",["ワリ鉱","warikou"],"SFC虹",["ツルツル","turuturu","tsurutsuru"],["ハイラル","hairaru"],["ネオパ","neopa"],["リボン","ribon"],["メトロ","metoro"],["リンリン","rinrin"],"BB",["ビッグブルー","bigguburu-"]];